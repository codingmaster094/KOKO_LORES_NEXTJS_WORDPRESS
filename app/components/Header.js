"use client";
import Link from "next/link";
import React, { useEffect, useRef, useState } from "react";
import { useParams } from "next/navigation";
import axios from "axios";
import { WORDPRESS_URL } from "../page";
import Image from "next/image";

 function Header() {
  const {slug} = useParams();
  const [BG_Header, setBG_Header] = useState(null);
  const [sticky, setSticky] = useState(false);
  const [menuActive, setMenuActive] = useState(false);
  const headerRef = useRef(null);
  const menuButtonRef = useRef(null);
  const closeButtonRef = useRef(null);
  const [Header_menu, setHeader_menu] = useState(null);
  const [Floating_Header_Menu, setFloating_Header_Menu] = useState(null);
  
  const BGHEADER = async() => {
    if(slug != undefined){
      const result = await axios.get(`${WORDPRESS_URL}/wp-json/custom/v1/page-acf-data?slug=${slug}`);
      setBG_Header(result.data.header_logo_color)
    }
  }
  const fetchHeader_menu = async () => {
    try {
      const result = await axios.get(`${WORDPRESS_URL}/wp-json/wp/v2/acf-options`);
      setHeader_menu(result.data);
    } catch (error) {
      console.error('Error fetching menu data', error);
    }
  };
  
  const fetchFloating_Header_Menu = async () => {
    try {
      const result = await axios.get(`${WORDPRESS_URL}/wp-json/wp/v2/menus`);
      setFloating_Header_Menu(result.data[0].items);
    } catch (error) {
      console.error('Error fetching menu data', error);
    } 
  };

  useEffect(() => {
    const handleScroll = () => {
      if (window.scrollY > 130) {
        setSticky(true);
      } else {
        setSticky(false);
      }
    };

    window.addEventListener("scroll", handleScroll);

    return () => {
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  const toggleMenu = () => {
    setMenuActive(!menuActive);
  };

  useEffect(() => {
    BGHEADER()
    fetchHeader_menu();
    fetchFloating_Header_Menu();
  }, []);

  return (
    <header ref={headerRef} className={`${BG_Header == "dark" ? 's-header' : ''} ${sticky ? "sticky" : ""}`}>
      <div className="container">
        <div className="header-wrapper flex items-start gap-3 justify-between md:py-10 sm:py-8 py-6">
          <div className="header-left flex items-start gap-8">
            <div className="logo">
              <Link href="/">
              {Header_menu && (
                <Image
                src={BG_Header == "dark"  ? Header_menu.header_dark_logo.url : Header_menu.header_light_logo.url} 
                alt={BG_Header == "light" ? Header_menu.header_dark_logo.alt :Header_menu.header_light_logo.alt}
                width={0}
                height={0}
                sizes="100vw"
                style={{ width: '100%', height: 'auto' }}
              />
              )}
              </Link>
            </div>
            {Header_menu && (
            <div className="social-icon flex items-center gap-6">
            <Link href={Header_menu.facebook_link.url} target={Header_menu.facebook_link.target} aria-label="Facebook">
              <svg
                  width="21"
                  height="22"
                  viewBox="0 0 21 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M21 1.67188V20.3281C21 20.6562 20.8594 20.9375 20.6719 21.1719C20.4375 21.4062 20.1562 21.5 19.8281 21.5H14.4844V13.3438H17.2031L17.625 10.2031H14.4844V8.1875C14.4844 7.67188 14.5781 7.29688 14.7656 7.0625C15 6.78125 15.4219 6.64062 16.0312 6.64062H17.7188V3.78125C17.0625 3.73438 16.2188 3.6875 15.2812 3.6875C14.0625 3.6875 13.0781 4.0625 12.3281 4.76562C11.5781 5.51562 11.2031 6.54688 11.2031 7.85938V10.2031H8.48438V13.3438H11.2031V21.5H1.17188C0.796875 21.5 0.515625 21.4062 0.328125 21.1719C0.09375 20.9375 0 20.6562 0 20.3281V1.67188C0 1.34375 0.09375 1.0625 0.328125 0.828125C0.515625 0.640625 0.796875 0.5 1.17188 0.5H19.8281C20.1094 0.5 20.3906 0.640625 20.625 0.828125C20.8594 1.0625 21 1.34375 21 1.67188Z"
                    fill={BG_Header == "dark" ? '#393d47' : '#d7cfc6'}
                  />
                </svg>
              </Link>
              <Link href={Header_menu.instagram_link.url} target={Header_menu.instagram_link.target} aria-label="Instagram">
              <svg
                    width="21"
                    height="22"
                    viewBox="0 0 21 22"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M10.5 5.60938C11.4375 5.60938 12.3281 5.89062 13.1719 6.35938C14.0156 6.82812 14.6719 7.48438 15.1406 8.32812C15.6094 9.17188 15.8906 10.0625 15.8906 11C15.8906 11.9844 15.6094 12.875 15.1406 13.7188C14.6719 14.5625 14.0156 15.2188 13.1719 15.6875C12.3281 16.1562 11.4375 16.3906 10.5 16.3906C9.51562 16.3906 8.625 16.1562 7.78125 15.6875C6.9375 15.2188 6.28125 14.5625 5.8125 13.7188C5.34375 12.875 5.10938 11.9844 5.10938 11C5.10938 10.0625 5.34375 9.17188 5.8125 8.32812C6.28125 7.48438 6.9375 6.82812 7.78125 6.35938C8.625 5.89062 9.51562 5.60938 10.5 5.60938ZM10.5 14.5156C11.4375 14.5156 12.2812 14.1875 12.9844 13.4844C13.6406 12.8281 14.0156 11.9844 14.0156 11C14.0156 10.0625 13.6406 9.21875 12.9844 8.51562C12.2812 7.85938 11.4375 7.48438 10.5 7.48438C9.51562 7.48438 8.67188 7.85938 8.01562 8.51562C7.3125 9.21875 6.98438 10.0625 6.98438 11C6.98438 11.9844 7.3125 12.8281 8.01562 13.4844C8.67188 14.1875 9.51562 14.5156 10.5 14.5156ZM17.3906 5.375C17.3906 5.04688 17.25 4.76562 17.0156 4.48438C16.7344 4.25 16.4531 4.10938 16.125 4.10938C15.75 4.10938 15.4688 4.25 15.2344 4.48438C14.9531 4.76562 14.8594 5.04688 14.8594 5.375C14.8594 5.75 14.9531 6.03125 15.2344 6.26562C15.4688 6.54688 15.75 6.64062 16.125 6.64062C16.4531 6.64062 16.7344 6.54688 16.9688 6.26562C17.2031 6.03125 17.3438 5.75 17.3906 5.375ZM20.9531 6.64062C20.9531 7.53125 21 8.98438 21 11C21 13.0625 20.9531 14.5156 20.9062 15.4062C20.8594 16.2969 20.7188 17.0469 20.5312 17.7031C20.25 18.5 19.7812 19.2031 19.2188 19.7656C18.6562 20.3281 17.9531 20.75 17.2031 21.0312C16.5469 21.2656 15.75 21.4062 14.8594 21.4531C13.9688 21.5 12.5156 21.5 10.5 21.5C8.4375 21.5 6.98438 21.5 6.09375 21.4531C5.20312 21.4062 4.45312 21.2656 3.79688 20.9844C3 20.75 2.29688 20.3281 1.73438 19.7656C1.17188 19.2031 0.75 18.5 0.46875 17.7031C0.234375 17.0469 0.09375 16.2969 0.046875 15.4062C0 14.5156 0 13.0625 0 11C0 8.98438 0 7.53125 0.046875 6.64062C0.09375 5.75 0.234375 4.95312 0.46875 4.29688C0.75 3.54688 1.17188 2.84375 1.73438 2.28125C2.29688 1.71875 3 1.25 3.79688 0.96875C4.45312 0.78125 5.20312 0.640625 6.09375 0.59375C6.98438 0.546875 8.4375 0.5 10.5 0.5C12.5156 0.5 13.9688 0.546875 14.8594 0.59375C15.75 0.640625 16.5469 0.78125 17.2031 0.96875C17.9531 1.25 18.6562 1.71875 19.2188 2.28125C19.7812 2.84375 20.25 3.54688 20.5312 4.29688C20.7188 4.95312 20.8594 5.75 20.9531 6.64062ZM18.7031 17.1875C18.8906 16.6719 18.9844 15.8281 19.0781 14.6562C19.0781 14 19.125 13.0156 19.125 11.75V10.25C19.125 8.98438 19.0781 8 19.0781 7.34375C18.9844 6.17188 18.8906 5.32812 18.7031 4.8125C18.3281 3.875 17.625 3.17188 16.6875 2.79688C16.1719 2.60938 15.3281 2.51562 14.1562 2.42188C13.4531 2.42188 12.4688 2.375 11.25 2.375H9.75C8.48438 2.375 7.5 2.42188 6.84375 2.42188C5.67188 2.51562 4.82812 2.60938 4.3125 2.79688C3.32812 3.17188 2.67188 3.875 2.29688 4.8125C2.10938 5.32812 1.96875 6.17188 1.92188 7.34375C1.875 8.04688 1.875 9.03125 1.875 10.25V11.75C1.875 13.0156 1.875 14 1.92188 14.6562C1.96875 15.8281 2.10938 16.6719 2.29688 17.1875C2.67188 18.1719 3.375 18.8281 4.3125 19.2031C4.82812 19.3906 5.67188 19.5312 6.84375 19.5781C7.5 19.625 8.48438 19.625 9.75 19.625H11.25C12.5156 19.625 13.5 19.625 14.1562 19.5781C15.3281 19.5312 16.1719 19.3906 16.6875 19.2031C17.625 18.8281 18.3281 18.125 18.7031 17.1875Z"
                      fill={BG_Header == "dark" ? '#393d47' : '#d7cfc6'}
                    />
                  </svg>
              </Link>
            </div>
            )}
          </div>
          <div
            className={`open-menu w-full md:w-3/5 lg:w-1/2 top-0 overflow-y-scroll pl-3.5 xl:pl-24 pr-6 absolute bg-color h-screen py-10 mobile-menu ${menuActive ? "active" : ""}`}
          >
            <div className="open-menu-logo flex items-start gap-8 pb-14">
              <div className="logo">
              {Header_menu && Header_menu.header_light_logo && (
                <Image
                src={Header_menu.header_light_logo.url}
                alt={Header_menu.header_light_logo.alt}
                width={0}
                height={0}
                sizes="100vw"
                style={{ width: '100%', height: 'auto' }}
              />
              )}
              </div>
              {Header_menu && (
              <div className="social-icon flex items-center gap-6">
              <Link href={Header_menu.facebook_link.url} target={Header_menu.target} aria-label="Facebook">
              <svg
                  width="21"
                  height="22"
                  viewBox="0 0 21 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M21 1.67188V20.3281C21 20.6562 20.8594 20.9375 20.6719 21.1719C20.4375 21.4062 20.1562 21.5 19.8281 21.5H14.4844V13.3438H17.2031L17.625 10.2031H14.4844V8.1875C14.4844 7.67188 14.5781 7.29688 14.7656 7.0625C15 6.78125 15.4219 6.64062 16.0312 6.64062H17.7188V3.78125C17.0625 3.73438 16.2188 3.6875 15.2812 3.6875C14.0625 3.6875 13.0781 4.0625 12.3281 4.76562C11.5781 5.51562 11.2031 6.54688 11.2031 7.85938V10.2031H8.48438V13.3438H11.2031V21.5H1.17188C0.796875 21.5 0.515625 21.4062 0.328125 21.1719C0.09375 20.9375 0 20.6562 0 20.3281V1.67188C0 1.34375 0.09375 1.0625 0.328125 0.828125C0.515625 0.640625 0.796875 0.5 1.17188 0.5H19.8281C20.1094 0.5 20.3906 0.640625 20.625 0.828125C20.8594 1.0625 21 1.34375 21 1.67188Z"
                    fill="#DCD4CA"
                  />
                </svg>
              </Link>
              <Link href={Header_menu.instagram_link.url} target={Header_menu.target} aria-label="Instagram">
                <svg
                    width="21"
                    height="22"
                    viewBox="0 0 21 22"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M10.5 5.60938C11.4375 5.60938 12.3281 5.89062 13.1719 6.35938C14.0156 6.82812 14.6719 7.48438 15.1406 8.32812C15.6094 9.17188 15.8906 10.0625 15.8906 11C15.8906 11.9844 15.6094 12.875 15.1406 13.7188C14.6719 14.5625 14.0156 15.2188 13.1719 15.6875C12.3281 16.1562 11.4375 16.3906 10.5 16.3906C9.51562 16.3906 8.625 16.1562 7.78125 15.6875C6.9375 15.2188 6.28125 14.5625 5.8125 13.7188C5.34375 12.875 5.10938 11.9844 5.10938 11C5.10938 10.0625 5.34375 9.17188 5.8125 8.32812C6.28125 7.48438 6.9375 6.82812 7.78125 6.35938C8.625 5.89062 9.51562 5.60938 10.5 5.60938ZM10.5 14.5156C11.4375 14.5156 12.2812 14.1875 12.9844 13.4844C13.6406 12.8281 14.0156 11.9844 14.0156 11C14.0156 10.0625 13.6406 9.21875 12.9844 8.51562C12.2812 7.85938 11.4375 7.48438 10.5 7.48438C9.51562 7.48438 8.67188 7.85938 8.01562 8.51562C7.3125 9.21875 6.98438 10.0625 6.98438 11C6.98438 11.9844 7.3125 12.8281 8.01562 13.4844C8.67188 14.1875 9.51562 14.5156 10.5 14.5156ZM17.3906 5.375C17.3906 5.04688 17.25 4.76562 17.0156 4.48438C16.7344 4.25 16.4531 4.10938 16.125 4.10938C15.75 4.10938 15.4688 4.25 15.2344 4.48438C14.9531 4.76562 14.8594 5.04688 14.8594 5.375C14.8594 5.75 14.9531 6.03125 15.2344 6.26562C15.4688 6.54688 15.75 6.64062 16.125 6.64062C16.4531 6.64062 16.7344 6.54688 16.9688 6.26562C17.2031 6.03125 17.3438 5.75 17.3906 5.375ZM20.9531 6.64062C20.9531 7.53125 21 8.98438 21 11C21 13.0625 20.9531 14.5156 20.9062 15.4062C20.8594 16.2969 20.7188 17.0469 20.5312 17.7031C20.25 18.5 19.7812 19.2031 19.2188 19.7656C18.6562 20.3281 17.9531 20.75 17.2031 21.0312C16.5469 21.2656 15.75 21.4062 14.8594 21.4531C13.9688 21.5 12.5156 21.5 10.5 21.5C8.4375 21.5 6.98438 21.5 6.09375 21.4531C5.20312 21.4062 4.45312 21.2656 3.79688 20.9844C3 20.75 2.29688 20.3281 1.73438 19.7656C1.17188 19.2031 0.75 18.5 0.46875 17.7031C0.234375 17.0469 0.09375 16.2969 0.046875 15.4062C0 14.5156 0 13.0625 0 11C0 8.98438 0 7.53125 0.046875 6.64062C0.09375 5.75 0.234375 4.95312 0.46875 4.29688C0.75 3.54688 1.17188 2.84375 1.73438 2.28125C2.29688 1.71875 3 1.25 3.79688 0.96875C4.45312 0.78125 5.20312 0.640625 6.09375 0.59375C6.98438 0.546875 8.4375 0.5 10.5 0.5C12.5156 0.5 13.9688 0.546875 14.8594 0.59375C15.75 0.640625 16.5469 0.78125 17.2031 0.96875C17.9531 1.25 18.6562 1.71875 19.2188 2.28125C19.7812 2.84375 20.25 3.54688 20.5312 4.29688C20.7188 4.95312 20.8594 5.75 20.9531 6.64062ZM18.7031 17.1875C18.8906 16.6719 18.9844 15.8281 19.0781 14.6562C19.0781 14 19.125 13.0156 19.125 11.75V10.25C19.125 8.98438 19.0781 8 19.0781 7.34375C18.9844 6.17188 18.8906 5.32812 18.7031 4.8125C18.3281 3.875 17.625 3.17188 16.6875 2.79688C16.1719 2.60938 15.3281 2.51562 14.1562 2.42188C13.4531 2.42188 12.4688 2.375 11.25 2.375H9.75C8.48438 2.375 7.5 2.42188 6.84375 2.42188C5.67188 2.51562 4.82812 2.60938 4.3125 2.79688C3.32812 3.17188 2.67188 3.875 2.29688 4.8125C2.10938 5.32812 1.96875 6.17188 1.92188 7.34375C1.875 8.04688 1.875 9.03125 1.875 10.25V11.75C1.875 13.0156 1.875 14 1.92188 14.6562C1.96875 15.8281 2.10938 16.6719 2.29688 17.1875C2.67188 18.1719 3.375 18.8281 4.3125 19.2031C4.82812 19.3906 5.67188 19.5312 6.84375 19.5781C7.5 19.625 8.48438 19.625 9.75 19.625H11.25C12.5156 19.625 13.5 19.625 14.1562 19.5781C15.3281 19.5312 16.1719 19.3906 16.6875 19.2031C17.625 18.8281 18.3281 18.125 18.7031 17.1875Z"
                      fill="#DCD4CA"
                    />
                </svg>
                </Link>
              </div>
              )
              }
            </div>
            <div className="menu-heads flex flex-col gap-6 lg:gap-9 xl:gap-12">
                {
                    Header_menu && Header_menu.header_menus_list.map((headerMenu, i) => {
                        return (
                            <div className="menu-head flex items-center justify-between gap-3 pb-6 xl:pb-12 lg:pb-9" key={i}>
                                <p className="text-white">{headerMenu.header_menus_title}</p>
                                <Link href={headerMenu.header_menu_link.url}>
                                    {headerMenu.header_menu_link.title}
                                </Link>
                            </div>
                        );
                    })
                }
            </div>
            <ul className="xl:pt-12 lg:pt-9 pt-6 flex flex-col gap-4">
              {
                Floating_Header_Menu && Floating_Header_Menu.map((items , i) => {
                  return  (
                  <li key={i}>
                      <Link href={items.path} >{items.title}</Link>
                  </li>
                )
                })
              }
            </ul>
          </div>
          <div className="header-right flex items-center gap-8">
          {Header_menu && (
            <Link href={Header_menu.header_reservieren_button.url} className="b-btn rounded-full">
            {Header_menu.header_reservieren_button.title}
            </Link>
          )}
            <div
              className="menu"
              ref={menuButtonRef}
              onClick={toggleMenu}
              style={{ display: !menuActive ? "block" : "none" }}
            >
                <svg
                width="35"
                height="29"
                viewBox="0 0 35 29"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M0 1.875C0 0.859375 0.78125 0 1.875 0H33.125C34.1406 0 35 0.859375 35 1.875C35 2.96875 34.1406 3.75 33.125 3.75H1.875C0.78125 3.75 0 2.96875 0 1.875ZM0 14.375C0 13.3594 0.78125 12.5 1.875 12.5H33.125C34.1406 12.5 35 13.3594 35 14.375C35 15.4688 34.1406 16.25 33.125 16.25H1.875C0.78125 16.25 0 15.4688 0 14.375ZM35 26.875C35 27.9688 34.1406 28.75 33.125 28.75H1.875C0.78125 28.75 0 27.9688 0 26.875C0 25.8594 0.78125 25 1.875 25H33.125C34.1406 25 35 25.8594 35 26.875Z"
                  fill="white"
                />
              </svg>
            </div>
            <div
              className="close z-10 md:z-0"
              ref={closeButtonRef}
              onClick={toggleMenu}
              style={{ display: menuActive ? "block" : "none" }}
            ><svg
                width="26"
                height="26"
                viewBox="0 0 26 26"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M24.9531 3.70312L15.5781 13.0781L24.875 22.375C25.6562 23.0781 25.6562 24.25 24.875 24.9531C24.1719 25.7344 23 25.7344 22.2969 24.9531L12.9219 15.6562L3.625 24.9531C2.92188 25.7344 1.75 25.7344 1.04688 24.9531C0.265625 24.25 0.265625 23.0781 1.04688 22.2969L10.3438 13L1.04688 3.70312C0.265625 3 0.265625 1.82812 1.04688 1.04688C1.75 0.34375 2.92188 0.34375 3.70312 1.04688L13 10.4219L22.2969 1.125C23 0.34375 24.1719 0.34375 24.9531 1.125C25.6562 1.82812 25.6562 3 24.9531 3.70312Z"
                  fill="white"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}

export default Header;
